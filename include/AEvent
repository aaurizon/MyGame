// Public event hierarchy used by application code to inspect window and input events.
#pragma once

#include <glm/vec2.hpp>
#include <EEventKey>

class AEvent {
public:
    enum class Type {
        Closed,
        KeyPressed,
        KeyReleased,
        MouseMoved,
        MouseButtonPressed,
        MouseButtonReleased
    };

    struct Closed;
    struct KeyPressed;
    struct KeyReleased;
    struct MouseMoved;
    struct MouseButtonPressed;
    struct MouseButtonReleased;

    virtual ~AEvent() = default;
    virtual Type getType() const = 0;

    template <typename T>
    bool is() const {
        return dynamic_cast<const T*>(this) != nullptr;
    }

    template <typename T>
    const T* getIf() const {
        return dynamic_cast<const T*>(this);
    }
};

// Derived event types are defined out of line to ensure AEvent is complete
// before being used as a base class.
struct AEvent::Closed : public AEvent {
    static constexpr Type StaticType = Type::Closed;
    Type getType() const override { return StaticType; }
};

struct AEvent::KeyPressed : public AEvent {
    static constexpr Type StaticType = Type::KeyPressed;
    explicit KeyPressed(EEventKey::Scancode code) : scancode(code) {}
    Type getType() const override { return StaticType; }
    EEventKey::Scancode scancode{EEventKey::Scancode::Unknown};
};

struct AEvent::KeyReleased : public AEvent {
    static constexpr Type StaticType = Type::KeyReleased;
    explicit KeyReleased(EEventKey::Scancode code) : scancode(code) {}
    Type getType() const override { return StaticType; }
    EEventKey::Scancode scancode{EEventKey::Scancode::Unknown};
};

struct AEvent::MouseMoved : public AEvent {
    static constexpr Type StaticType = Type::MouseMoved;
    MouseMoved(float dx, float dy, float x, float y) : delta(dx, dy), position(x, y) {}
    Type getType() const override { return StaticType; }
    glm::vec2 delta;
    glm::vec2 position;
};

struct AEvent::MouseButtonPressed : public AEvent {
    static constexpr Type StaticType = Type::MouseButtonPressed;
    explicit MouseButtonPressed(EEventKey::Scancode buttonCode) : scancode(buttonCode) {}
    Type getType() const override { return StaticType; }
    EEventKey::Scancode scancode{EEventKey::Scancode::Unknown};
};

struct AEvent::MouseButtonReleased : public AEvent {
    static constexpr Type StaticType = Type::MouseButtonReleased;
    explicit MouseButtonReleased(EEventKey::Scancode buttonCode) : scancode(buttonCode) {}
    Type getType() const override { return StaticType; }
    EEventKey::Scancode scancode{EEventKey::Scancode::Unknown};
};
